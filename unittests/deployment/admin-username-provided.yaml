suite: deployment template (admin username provided, the default)
release:
  name: forgejo-unittests
  namespace: testing
templates:
  - templates/gitea/deployment.yaml
  - templates/gitea/config.yaml
tests:
  - it: env vars are present
    template: templates/gitea/deployment.yaml
    asserts:
      - isNotNull:
          path: spec.template.spec.initContainers[?(@.name == 'configure-gitea')].env[?(@.name == 'GITEA_ADMIN_USERNAME')]
      - equal:
          path: spec.template.spec.initContainers[?(@.name == 'configure-gitea')].env[?(@.name == 'GITEA_ADMIN_USERNAME')].valueFrom.secretKeyRef.name
          value: forgejo-unittests-admin
      - isNotNull:
          path: spec.template.spec.initContainers[?(@.name == 'configure-gitea')].env[?(@.name == 'GITEA_ADMIN_PASSWORD')]
      - equal:
          path: spec.template.spec.initContainers[?(@.name == 'configure-gitea')].env[?(@.name == 'GITEA_ADMIN_PASSWORD')].valueFrom.secretKeyRef.name
          value: forgejo-unittests-admin
